<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Family Expense Tracker Dashboard</title>
    <!-- Bootstrap CSS -->
    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
        crossorigin="anonymous"
    />
    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet"
    />
    <!-- Custom Styles -->
    <style>
        body {
            font-family: "Poppins", sans-serif;
            background-color: #f4f7fa;
        }

        .sidebar {
            background-color: #2c3e50;
            color: #ecf0f1;
            min-height: 100vh;
        }

        .sidebar a.nav-link {
            color: #ecf0f1;
            padding-top: 1rem;
            padding-bottom: 1rem;
        }

        .sidebar a.nav-link.active,
        .sidebar a.nav-link:hover {
            background-color: #34495e;
        }

        .amount {
            font-size: 2rem;
            font-weight: 600;
        }

        .income {
            color: #198754; /* Bootstrap success green */
        }

        .expense {
            color: #dc3545; /* Bootstrap danger red */
        }

        .balance {
            color: #0d6efd; /* Bootstrap primary blue */
        }

        /* Fix for the footer positioning */
        .sidebar .position-sticky {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .sidebar-footer {
            margin-top: auto;
        }
    </style>
</head>

<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav class="col-md-3 col-lg-2 d-md-block sidebar p-0">
                <div class="position-sticky">
                    <h2 class="h4 p-3 text-center">Family Tracker</h2>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="index.html">Dashboard</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="income.html">Income</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="expenses.html">Expenses</a>
                        </li>
                    </ul>
                    <div class="sidebar-footer p-3 text-center">
                        <p class="mb-0">Â© 2025 Poudel Family</p>
                    </div>
                </div>
            </nav>

            <!-- Main Content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <header
                    class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom"
                >
                    <h1 class="h2">Dashboard</h1>
                    <div class="user-info">
                        <span>Welcome, Poudel Family</span>
                    </div>
                </header>

                <!-- Summary Cards -->
                <section class="summary">
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h3 class="card-title h5 text-muted">Total Income</h3>
                                    <p id="total-income" class="card-text amount income">$0.00</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h3 class="card-title h5 text-muted">Total Expense</h3>
                                    <p id="total-expense" class="card-text amount expense">$0.00</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h3 class="card-title h5 text-muted">Balance</h3>
                                    <p id="balance" class="card-text amount balance">$0.00</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Recent Transactions -->
                <section class="recent-transactions">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="h5 mb-0">Recent Transactions</h2>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th scope="col">Date</th>
                                            <th scope="col">Description</th>
                                            <th scope="col">Category</th>
                                            <th scope="col" class="text-end">Amount</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recent-transactions-tbody">
                                        <!-- Populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- Bootstrap JS Bundle -->
    <script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"
    ></script>

    <script>
        // Helper: safely parse JSON or return []
        function getData(key) {
            const data = localStorage.getItem(key);
            try {
                return data ? JSON.parse(data) : [];
            } catch {
                return [];
            }
        }

        // Format number as currency string $x,xxx.xx
        function formatCurrency(amount) {
            return "$" + Number(amount).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

        // Load and display totals + recent transactions
        function loadDashboardData() {
            const incomes = getData("incomeData");
            const expenses = getData("expenseData");

            // Calculate totals
            const totalIncome = incomes.reduce((sum, inc) => sum + Number(inc.amount), 0);
            const totalExpense = expenses.reduce((sum, exp) => sum + Number(exp.amount), 0);
            const balance = totalIncome - totalExpense;

            // Update summary cards
            document.getElementById("total-income").textContent = formatCurrency(totalIncome);
            document.getElementById("total-expense").textContent = formatCurrency(totalExpense);
            document.getElementById("balance").textContent = formatCurrency(balance);

            // Combine transactions with type info
            const combined = [];

            incomes.forEach((inc) => {
                combined.push({
                    date: inc.date,
                    description: inc.source || "Income",
                    category: "Income",
                    amount: Number(inc.amount),
                    type: "income",
                });
            });

            expenses.forEach((exp) => {
                combined.push({
                    date: exp.date,
                    description: exp.description,
                    category: exp.category,
                    amount: Number(exp.amount),
                    type: "expense",
                });
            });

            // Sort by date descending (most recent first)
            combined.sort((a, b) => new Date(b.date) - new Date(a.date));

            // Take top 7 transactions
            const recent7 = combined.slice(0, 7);

            // Populate table body
            const tbody = document.getElementById("recent-transactions-tbody");
            tbody.innerHTML = ""; // clear old rows

            recent7.forEach((tx) => {
                const tr = document.createElement("tr");

                // Format amount with sign and class
                let amountText = (tx.type === "income" ? "+" : "-") + formatCurrency(tx.amount);
                let amountClass = tx.type === "income" ? "text-success" : "text-danger";

                tr.innerHTML = `
                    <td>${tx.date}</td>
                    <td>${tx.description}</td>
                    <td>${tx.category}</td>
                    <td class="text-end fw-bold ${amountClass}">${amountText}</td>
                `;

                tbody.appendChild(tr);
            });
        }

        // Run on page load
        window.addEventListener("DOMContentLoaded", loadDashboardData);
    </script>
</body>

</html>
